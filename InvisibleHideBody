local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "InvisibleGui"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 150, 0, 100)
MainFrame.Position = UDim2.new(0.5, -75, 0.5, -50)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.Text = "invisible"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18
Title.Font = Enum.Font.SourceSansBold
Title.Parent = MainFrame

local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Size = UDim2.new(0.8, 0, 0, 40)
ToggleBtn.Position = UDim2.new(0.1, 0, 0.45, 0)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
ToggleBtn.Text = "OFF"
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.Font = Enum.Font.SourceSansBold
ToggleBtn.TextSize = 16
ToggleBtn.Parent = MainFrame

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 6)
btnCorner.Parent = ToggleBtn

local isActive = false
local connection
local fakeChar
local fakeRoot
local floatPart

local function stopGodMode()
    if not isActive then return end
    isActive = false
    
    ToggleBtn.Text = "OFF"
    ToggleBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
    
    local char = LocalPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    
    if root and fakeRoot then
        root.CFrame = fakeRoot.CFrame
    end
    
    if connection then connection:Disconnect() end
    if fakeChar then fakeChar:Destroy() end
    if floatPart then floatPart:Destroy() end
    
    if hum then
        workspace.CurrentCamera.CameraSubject = hum
    end

    StarterGui:SetCore("SendNotification", {
        Title = "Status",
        Text = "Invisible: Off",
        Duration = 3
    })
end

local function startGodMode()
    if isActive then return end
    local char = LocalPlayer.Character
    if not char then return end

    local root = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not root or not hum then return end

    isActive = true
    
    ToggleBtn.Text = "ON"
    ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)

    char.Archivable = true
    fakeChar = char:Clone()
    char.Archivable = false

    local lastPos = root.CFrame
    local hiddenPos = lastPos * CFrame.new(0, 5000, 0)

    fakeChar.Parent = workspace
    local fakeHum = fakeChar:FindFirstChildOfClass("Humanoid")
    fakeRoot = fakeChar:FindFirstChild("HumanoidRootPart")

    local animScript = fakeChar:FindFirstChild("Animate")
    if animScript then
        animScript.Disabled = true
        task.wait(0.1)
        animScript.Disabled = false
    end

    floatPart = Instance.new("Part")
    floatPart.Size = Vector3.new(4, 0.5, 4)
    floatPart.Transparency = 1
    floatPart.CanCollide = true
    floatPart.Anchored = true
    floatPart.Parent = workspace

    workspace.CurrentCamera.CameraSubject = fakeHum

    connection = RunService.RenderStepped:Connect(function()
        if isActive and char and root and fakeRoot and fakeHum then
            root.CFrame = hiddenPos
            root.Velocity = Vector3.new(0, 0, 0)
            floatPart.CFrame = root.CFrame * CFrame.new(0, -3.1, 0)
            fakeHum:Move(hum.MoveDirection, false)
            if hum.Jump then fakeHum.Jump = true end
            if fakeHum.Health <= 0 then fakeHum.Health = fakeHum.MaxHealth end
        else
            stopGodMode()
        end
    end)

    fakeRoot.CFrame = lastPos
    
    StarterGui:SetCore("SendNotification", {
        Title = "Status",
        Text = "Invisible: On",
        Duration = 3
    })
end

ToggleBtn.MouseButton1Click:Connect(function()
    if isActive then
        stopGodMode()
    else
        startGodMode()
    end
end)

local dragToggle = nil
local dragStart = nil
local startPos = nil

local function updateInput(input)
    local delta = input.Position - dragStart
    local position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    MainFrame.Position = position
end

MainFrame.InputBegan:Connect(function(input)
    if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
        dragToggle = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragToggle = false
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragToggle and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        updateInput(input)
    end
end)
