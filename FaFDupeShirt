local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local TitleLabel = Instance.new("TextLabel")
local TogglePallet = Instance.new("TextButton")
local ToggleDupe = Instance.new("TextButton")
local ToggleAutoX = Instance.new("TextButton")
local IntervalInput = Instance.new("TextBox")
local IntervalLabel = Instance.new("TextLabel")

local VIM = game:GetService("VirtualInputManager")

-- GUI Setup
ScreenGui.Parent = game.CoreGui
MainFrame.Name = "MadWrite"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -75, 0.5, -110)
MainFrame.Size = UDim2.new(0, 160, 0, 225) 
MainFrame.Active = true
MainFrame.Draggable = true

TitleLabel.Parent = MainFrame
TitleLabel.Size = UDim2.new(1, 0, 0, 30)
TitleLabel.Text = "MadWrite"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
TitleLabel.Font = Enum.Font.SourceSansBold
TitleLabel.TextSize = 18

-- UI: Interval Section
IntervalLabel.Parent = MainFrame
IntervalLabel.Position = UDim2.new(0, 10, 0, 35)
IntervalLabel.Size = UDim2.new(0, 140, 0, 20)
IntervalLabel.Text = "Interval" -- Tulisan Tree/Plank dihapus
IntervalLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
IntervalLabel.BackgroundTransparency = 1
IntervalLabel.TextSize = 12
IntervalLabel.TextXAlignment = Enum.TextXAlignment.Left

IntervalInput.Parent = MainFrame
IntervalInput.Position = UDim2.new(0.1, 0, 0, 55)
IntervalInput.Size = UDim2.new(0.8, 0, 0, 25)
IntervalInput.Text = "5" -- Default balik ke 5
IntervalInput.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
IntervalInput.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Buttons Setup
local function StyleButton(btn, text, yPos, color)
    btn.Parent = MainFrame
    btn.Position = UDim2.new(0.1, 0, 0, yPos)
    btn.Size = UDim2.new(0.8, 0, 0, 35)
    btn.Text = text .. ": OFF"
    btn.BackgroundColor3 = color
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSansBold
    btn.BorderSizePixel = 0
end

StyleButton(TogglePallet, "Auto Pallet", 85, Color3.fromRGB(200, 50, 50))
StyleButton(ToggleDupe, "Dupe", 130, Color3.fromRGB(70, 70, 70))
StyleButton(ToggleAutoX, "Auto X", 175, Color3.fromRGB(60, 60, 120))

-- Logic Variables
local runningPallet = false
local runningDupe = false
local runningAutoX = false
local Larry = game:GetService("ReplicatedStorage"):WaitForChild("Modules"):WaitForChild("Larry")

-- [ LOGIC AUTO PALLET ]
task.spawn(function()
    while true do
        if runningPallet then
            pcall(function()
                local pallet = workspace:WaitForChild("DraggableObjects"):FindFirstChild("Pallet")
                if pallet then
                    -- 1. Ambil Pallet
                    Larry:WaitForChild("FNCPickUpPallet"):InvokeServer(pallet, 8)
                    
                    -- 2. Jeda 1 detik agar stabil sebelum drop
                    task.wait(1)
                    
                    -- 3. Cari Target dan Drop Onto
                    for _, b in pairs(workspace.Buildings:GetChildren()) do
                        if b.Name == "PalletStorage" or b:FindFirstChild("Functional") then
                            local hit = b.Functional 
                                and b.Functional:FindFirstChild("Input") 
                                and b.Functional.Input:FindFirstChild("A") 
                                and b.Functional.Input.A.Hitbox:FindFirstChild("PalletAttachment")
                            
                            if hit then 
                                Larry:WaitForChild("FNCDropPalletOnto"):InvokeServer(hit, 2.093551)
                                break 
                            end
                        end
                    end
                end
            end)
            -- 4. Tunggu interval (Default 5 detik)
            task.wait(tonumber(IntervalInput.Text) or 5)
        else
            task.wait(0.5)
        end
    end
end)

-- [ LOGIC DUPE ]
task.spawn(function()
    while true do
        if runningDupe then
            pcall(function()
                for _, b in ipairs(workspace.Buildings:GetChildren()) do
                    if b.Name == "SpindleMachine" then
                        Larry:WaitForChild("EVTSpindle.Withdraw"):FireServer(b)
                    elseif not runningAutoX and b.Name == "ShirtFactory" then
                        local input = b.Functional.IO.Input:FindFirstChild("WoolBundles")
                        if input then
                            task.spawn(function()
                                task.wait(0.05)
                                Larry:WaitForChild("FNCInsertDraggable"):InvokeServer(b, input)
                            end)
                        end
                    end
                end
            end)
        end
        task.wait()
    end
end)

-- [ LOGIC AUTO X ]
task.spawn(function()
    while true do
        if runningAutoX then
            VIM:SendKeyEvent(true, Enum.KeyCode.X, false, game)
            task.wait(0.05)
            VIM:SendKeyEvent(false, Enum.KeyCode.X, false, game)
            
            task.wait(tonumber(IntervalInput.Text) or 5)
        else
            task.wait(0.5)
        end
    end
end)

-- Button Events
TogglePallet.MouseButton1Click:Connect(function()
    runningPallet = not runningPallet
    TogglePallet.Text = "Pallet: " .. (runningPallet and "ON" or "OFF")
    TogglePallet.BackgroundColor3 = runningPallet and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
end)

ToggleDupe.MouseButton1Click:Connect(function()
    runningDupe = not runningDupe
    ToggleDupe.Text = "Dupe: " .. (runningDupe and "ON" or "OFF")
    ToggleDupe.BackgroundColor3 = runningDupe and Color3.fromRGB(0, 150, 255) or Color3.fromRGB(70, 70, 70)
end)

ToggleAutoX.MouseButton1Click:Connect(function()
    runningAutoX = not runningAutoX
    ToggleAutoX.Text = "Auto X: " .. (runningAutoX and "ON" or "OFF")
    ToggleAutoX.BackgroundColor3 = runningAutoX and Color3.fromRGB(255, 100, 0) or Color3.fromRGB(60, 60, 120)
end)
